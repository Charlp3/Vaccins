<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Vaccins</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===== Base ===== */
body{
    font-family:-apple-system,BlinkMacSystemFont,sans-serif;
    background:#e1e1e1;
    margin:0;
    font-size:18px;
    color:#333;
}

/* ===== En-t√™te ===== */
header{
    background:#b3b6bb;
    color:#2e2e2e;
    text-align:center;
    padding:16px;
}
header h1{margin:0;font-size:28px;font-weight:600;}
header small{display:block;margin-top:6px;font-size:14px;color:#4f4f4f;}

/* ===== Navigation ===== */
nav{display:flex;background:#c4c7cc;}
nav button{
    flex:1;padding:14px;border:none;
    background:#c4c7cc;font-weight:600;font-size:16px;color:#444;
}
nav button.active{background:#aeb1b6;color:#2f2f2f;}

/* ===== Sections ===== */
section{display:none;padding:14px;}
section.active{display:block;}

/* ===== Champs ===== */
input, textarea{
    width:100%;padding:10px;margin-bottom:10px;
    font-size:18px;background:#d4d6da;
    border:1px solid #b0b2b6;color:#333;border-radius:4px;
}
textarea{height:80px;}

/* ===== Boutons ===== */
button.add, button.util{
    background:#bfc2c6;color:#2e2e2e;border:none;
    padding:10px;width:100%;font-size:17px;
    margin-bottom:8px;border-radius:4px;font-weight:600;
}
button.del{
    background:#8a8d92;color:#f2f2f2;border:none;
    padding:6px 10px;font-size:16px;border-radius:4px;
}

/* ===== Tableaux ===== */
table{width:100%;border-collapse:collapse;font-size:17px;}
th{
    background:#b9bcc1;color:#2e2e2e;font-weight:600;
    cursor:pointer;
}
th, td{padding:10px;border:1px solid #b1b3b7;}
tr:nth-child(even){background:#d8dadf;}
tr:nth-child(odd){background:#e3e5e9;}

a{color:#4a6a8a;word-break:break-all;}
</style>
</head>

<body>

<header>
    <h1>Vaccins</h1>
    <small>v1.6 ‚Äì ¬© Pierre Charlier 2025</small>
</header>

<nav>
    <button class="active" onclick="showTab('fiche',this)">Ma fiche</button>
    <button onclick="showTab('vaccins',this)">Vaccinations</button>
    <button onclick="showTab('notices',this)">Notices</button>
    <button onclick="showTab('resume',this)">R√©sum√©</button>
</nav>

<section id="fiche" class="active">
    <h3>Informations personnelles</h3>
    <input id="nom" placeholder="Nom">
    <input id="prenom" placeholder="Pr√©nom">
    <input id="naissance" type="date">
    <textarea id="remarque" placeholder="Remarques"></textarea>

    <button class="util" onclick="save()">üíæ Sauvegarder</button>
    <button class="util" onclick="exportJSON()">‚¨áÔ∏è Exporter JSON</button>
    <input type="file" id="importFile" accept=".json" style="display:none" onchange="importJSON(this)">
    <button class="util" onclick="document.getElementById('importFile').click()">‚¨ÜÔ∏è Importer JSON</button>
</section>

<section id="vaccins">
    <h3>Vaccinations</h3>
    <input id="vaccinNom" placeholder="Nom du vaccin">
    <input id="vaccinDate" type="date">
    <button class="add" onclick="addVaccin()">Ajouter</button>

    <table>
        <thead>
            <tr>
                <th onclick="setSort('vaccins','nom')">Vaccin</th>
                <th onclick="setSort('vaccins','date')">Date</th>
                <th></th>
            </tr>
        </thead>
        <tbody id="vaccinTable"></tbody>
    </table>
</section>

<section id="notices">
    <h3>Notices</h3>
    <input id="noticeNom" placeholder="Nom du vaccin">
    <input id="noticeURL" placeholder="URL de la notice">
    <button class="add" onclick="addNotice()">Ajouter</button>

    <table>
        <thead>
            <tr>
                <th onclick="setSort('notices','nom')">Vaccin</th>
                <th>Notice</th>
                <th></th>
            </tr>
        </thead>
        <tbody id="noticeTable"></tbody>
    </table>
</section>

<section id="resume">
    <h3>R√©sum√© vaccinal</h3>
    <table>
        <thead>
            <tr>
                <th onclick="setSort('vaccins','nom')">Vaccin</th>
                <th onclick="setSort('vaccins','date')">Date</th>
            </tr>
        </thead>
        <tbody id="resumeTable"></tbody>
    </table>
</section>

<script>
let data = JSON.parse(localStorage.getItem("vaccinsData")) || {
    fiche:{}, vaccins:[], notices:[]
};

let sortState = { section:null, field:null, asc:true };

function save(){
    localStorage.setItem("vaccinsData", JSON.stringify(data));
}

function exportJSON(){
    const blob = new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob); a.download="vaccins.json"; a.click();
}

function importJSON(input){
    const file=input.files[0]; if(!file) return;
    const reader=new FileReader();
    reader.onload=e=>{
        try{
            const obj=JSON.parse(e.target.result);
            if(!obj.fiche||!Array.isArray(obj.vaccins)||!Array.isArray(obj.notices)) throw "";
            data=obj; save(); render();
            alert("Import r√©ussi");
        }catch{ alert("Fichier JSON invalide"); }
    };
    reader.readAsText(file);
}

function showTab(id,btn){
    document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
    document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
    document.getElementById(id).classList.add("active"); btn.classList.add("active");
}

function addVaccin(){
    if(!vaccinNom.value||!vaccinDate.value) return;
    data.vaccins.push({nom:vaccinNom.value,date:vaccinDate.value});
    vaccinNom.value=""; vaccinDate.value=""; save(); render();
}

function addNotice(){
    if(!noticeNom.value||!noticeURL.value) return;
    data.notices.push({nom:noticeNom.value,url:noticeURL.value});
    noticeNom.value=""; noticeURL.value=""; save(); render();
}

function delVaccin(i){
    if(!confirm("Confirmer la suppression de ce vaccin ?")) return;
    data.vaccins.splice(i,1); save(); render();
}
function delNotice(i){
    if(!confirm("Confirmer la suppression de cette notice ?")) return;
    data.notices.splice(i,1); save(); render();
}

/* ===== TRI ===== */
function setSort(section, field){
    if(sortState.section===section && sortState.field===field){
        sortState.asc=!sortState.asc;
    }else{
        sortState={section,field,asc:true};
    }
    render();
}

function getSorted(arr){
    if(!sortState.field) return [...arr];
    return [...arr].sort((a,b)=>{
        let x=a[sortState.field], y=b[sortState.field];
        if(sortState.field==="date"){ x=new Date(x); y=new Date(y); }
        return (x>y?1:-1)*(sortState.asc?1:-1);
    });
}

function formatDateFR(iso){
    if(!iso) return "";
    const d = new Date(iso);
    return d.toLocaleDateString("fr-FR");
}
/* ===== RENDER ===== */
function render(){
    vaccinTable.innerHTML=""; noticeTable.innerHTML=""; resumeTable.innerHTML="";

    const vaccins = sortState.section==="vaccins" ? getSorted(data.vaccins) : data.vaccins;

    vaccins.forEach((v,i)=>{
        vaccinTable.innerHTML+=`
        239 <tr><td>${v.nom}</td><td>${formatDateFR(v.date)}</td>
        <td><button class="del" onclick="delVaccin(${i})">‚úï</button></td></tr>`;
        241 resumeTable.innerHTML+=`<tr><td>${v.nom}</td><td>${formatDateFR(v.date)}</td></tr>`;
    });

    const notices = sortState.section==="notices" ? getSorted(data.notices) : data.notices;
    notices.forEach((n,i)=>{
        noticeTable.innerHTML+=`
        <tr><td>${n.nom}</td>
        <td><a href="${n.url}" target="_blank">${n.url}</a></td>
        <td><button class="del" onclick="delNotice(${i})">‚úï</button></td></tr>`;
    });

    ["nom","prenom","naissance","remarque"].forEach(id=>{
        document.getElementById(id).value=data.fiche[id]||"";
    });
}

["nom","prenom","naissance","remarque"].forEach(id=>{
    document.getElementById(id).addEventListener("input",e=>{
        data.fiche[id]=e.target.value; save();
    });
});

render();
</script>

</body>
</html>