<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Vaccins</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    background: #f0d97a;
    margin: 0;
    font-size: 18px;
}

header {
    background: #d4ac0d;
    color: #000;
    text-align: center;
    padding: 16px;
}

header h1 {
    margin: 0;
    font-size: 28px;
}

header small {
    display: block;
    margin-top: 6px;
    font-size: 14px;
}

nav {
    display: flex;
    background: #c9a000;
}

nav button {
    flex: 1;
    padding: 14px;
    border: none;
    background: #c9a000;
    font-weight: bold;
    font-size: 16px;
}

nav button.active {
    background: #a88900;
    color: white;
}

section {
    display: none;
    padding: 14px;
}

section.active {
    display: block;
}

input, textarea {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    font-size: 18px;
    background: #fff3b0;
    border: 1px solid #8a6d00;
}

textarea {
    height: 80px;
}

button.add {
    background: #a88900;
    color: white;
    border: none;
    padding: 10px;
    width: 100%;
    font-weight: bold;
    font-size: 18px;
    margin-bottom: 10px;
}

button.del {
    background: #a93226;
    color: white;
    border: none;
    padding: 6px 10px;
    font-size: 16px;
}

button.util {
    background: #7d6608;
    color: white;
    border: none;
    padding: 10px;
    width: 100%;
    font-size: 17px;
    margin-bottom: 8px;
}

table {
    width: 100%;
    border-collapse: collapse;
    font-size: 17px;
}

th, td {
    padding: 10px;
    border: 1px solid #7d6608;
}

tr:nth-child(even) {
    background: #f7dc6f;
}

tr:nth-child(odd) {
    background: #fff9c4;
}

a {
    color: #154360;
    word-break: break-all;
}
</style>
</head>

<body>

<header>
    <h1>Vaccins</h1>
    <small>v1.1 ‚Äì ¬© Pierre Charlier 2025</small>
</header>

<nav>
    <button onclick="showTab('fiche')" class="active">Ma fiche</button>
    <button onclick="showTab('vaccins')">Vaccinations</button>
    <button onclick="showTab('notices')">Notices</button>
    <button onclick="showTab('resume')">R√©sum√©</button>
</nav>

<section id="fiche" class="active">
    <h3>Informations personnelles</h3>
    <input id="nom" placeholder="Nom">
    <input id="prenom" placeholder="Pr√©nom">
    <input id="naissance" type="date">
    <textarea id="remarque" placeholder="Remarques"></textarea>

    <button class="util" onclick="save()">üíæ Sauvegarder</button>
    <button class="util" onclick="exportJSON()">‚¨áÔ∏è Exporter JSON</button>
    <input type="file" id="importFile" accept=".json" onchange="importJSON(this)" style="display:none">
    <button class="util" onclick="document.getElementById('importFile').click()">‚¨ÜÔ∏è Importer JSON</button>
</section>

<section id="vaccins">
    <h3>Vaccinations</h3>
    <input id="vaccinNom" placeholder="Nom du vaccin">
    <input id="vaccinDate" type="date">
    <button class="add" onclick="addVaccin()">Ajouter</button>

    <table>
        <thead>
            <tr><th>Vaccin</th><th>Date</th><th></th></tr>
        </thead>
        <tbody id="vaccinTable"></tbody>
    </table>
</section>

<section id="notices">
    <h3>Notices</h3>
    <input id="noticeNom" placeholder="Nom du vaccin">
    <input id="noticeURL" placeholder="URL de la notice">
    <button class="add" onclick="addNotice()">Ajouter</button>

    <table>
        <thead>
            <tr><th>Vaccin</th><th>Notice</th><th></th></tr>
        </thead>
        <tbody id="noticeTable"></tbody>
    </table>
</section>

<section id="resume">
    <h3>R√©sum√© vaccinal</h3>
    <table>
        <thead>
            <tr><th>Vaccin</th><th>Date</th></tr>
        </thead>
        <tbody id="resumeTable"></tbody>
    </table>
</section>

<script>
let data = JSON.parse(localStorage.getItem("vaccinsData")) || {
    fiche: {},
    vaccins: [],
    notices: []
};

function save() {
    localStorage.setItem("vaccinsData", JSON.stringify(data));
    alert("Donn√©es sauvegard√©es");
}

function exportJSON() {
    const blob = new Blob([JSON.stringify(data, null, 2)], {type: "application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "vaccins.json";
    a.click();
}

function importJSON(input) {
    const file = input.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
        try {
            const obj = JSON.parse(e.target.result);
            if (!obj.vaccins || !obj.notices || !obj.fiche) throw "invalid";
            data = obj;
            save();
            render();
        } catch {
            alert("Fichier JSON invalide");
        }
    };
    reader.readAsText(file);
}

function showTab(id) {
    document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
    document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    event.target.classList.add("active");
}

function addVaccin() {
    if (!vaccinNom.value || !vaccinDate.value) return;
    data.vaccins.push({ nom: vaccinNom.value, date: vaccinDate.value });
    vaccinNom.value = "";
    vaccinDate.value = "";
    save();
    render();
}

function addNotice() {
    if (!noticeNom.value || !noticeURL.value) return;
    data.notices.push({ nom: noticeNom.value, url: noticeURL.value });
    noticeNom.value = "";
    noticeURL.value = "";
    save();
    render();
}

function delVaccin(i) {
    data.vaccins.splice(i,1);
    save();
    render();
}

function delNotice(i) {
    data.notices.splice(i,1);
    save();
    render();
}

function render() {
    vaccinTable.innerHTML = "";
    noticeTable.innerHTML = "";
    resumeTable.innerHTML = "";

    data.vaccins.forEach((v,i) => {
        vaccinTable.innerHTML += `<tr>
            <td>${v.nom}</td>
            <td>${v.date}</td>
            <td><button class="del" onclick="delVaccin(${i})">‚úï</button></td>
        </tr>`;
        resumeTable.innerHTML += `<tr><td>${v.nom}</td><td>${v.date}</td></tr>`;
    });

    data.notices.forEach((n,i) => {
        noticeTable.innerHTML += `<tr>
            <td>${n.nom}</td>
            <td><a href="${n.url}" target="_blank">${n.url}</a></td>
            <td><button class="del" onclick="delNotice(${i})">‚úï</button></td>
        </tr>`;
    });

    ["nom","prenom","naissance","remarque"].forEach(id => {
        document.getElementById(id).value = data.fiche[id] || "";
    });
}

["nom","prenom","naissance","remarque"].forEach(id => {
    document.getElementById(id).addEventListener("input", e => {
        data.fiche[id] = e.target.value;
    });
});

render();
</script>

</body>
</html>