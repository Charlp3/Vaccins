<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Vaccins</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===== Base ===== */
body{
    font-family:-apple-system,BlinkMacSystemFont,sans-serif;
    background:#e1e1e1;
    margin:0;
    font-size:18px;
    color:#333;
}

/* ===== En-t√™te ===== */
header{
    background:#b3b6bb;
    text-align:center;
    padding:16px;
}
header h1{margin:0;font-size:30px;font-weight:600;}
header small{display:block;font-size:14px;color:#555;}

/* ===== Navigation (onglets AGRANDIS) ===== */
nav{
    display:flex;
    background:#c4c7cc;
}
nav button{
    flex:1;
    padding:16px;
    border:none;
    background:#c4c7cc;
    font-weight:600;
    font-size:18px;          /* ‚¨ÖÔ∏è plus grand */
    color:#444;
}
nav button.active{
    background:#aeb1b6;
    color:#2f2f2f;
}

/* ===== Sections ===== */
section{display:none;padding:14px;}
section.active{display:block;}

/* ===== Champs (gris, jamais blancs) ===== */
input, textarea, select{
    width:100%;
    padding:12px;
    margin-bottom:12px;
    font-size:18px;
    background:#d4d6da;
    border:1px solid #b0b2b6;
    color:#333;
    border-radius:4px;
}
textarea{height:90px;}

/* ===== Boutons ===== */
button.add, button.util{
    background:#bfc2c6;
    border:none;
    padding:12px;
    width:100%;
    margin-bottom:10px;
    font-size:18px;
    border-radius:4px;
    font-weight:600;
    color:#2e2e2e;
}
button.del{
    background:#8a8d92;
    color:#f2f2f2;
    border:none;
    padding:8px 12px;
    font-size:16px;
    border-radius:4px;
}

/* ===== Tableaux ===== */
table{width:100%;border-collapse:collapse;font-size:18px;}
th,td{padding:12px;border:1px solid #b1b3b7;}
th{
    background:#b9bcc1;
    font-weight:600;
    cursor:pointer;
}
tr:nth-child(even){background:#d8dadf;}
tr:nth-child(odd){background:#e3e5e9;}

a{color:#4a6a8a;word-break:break-all;}
</style>
</head>

<body>

<header>
<h1>Vaccins</h1>
<small>v1.7 ‚Äì ¬© Pierre Charlier 2025</small>
</header>

<nav>
<button class="active" onclick="showTab('fiche',this)">Fiche</button>
<button onclick="showTab('vaccins',this)">Vaccinations</button>
<button onclick="showTab('notices',this)">Notices</button>
<button onclick="showTab('resume',this)">R√©sum√©</button>
</nav>

<!-- ===== FICHE ===== -->
<section id="fiche" class="active">
<h3>Personne</h3>
<select id="personSelect" onchange="switchPerson(this.value)">
<option value="0">Personne 1</option>
<option value="1">Personne 2</option>
</select>

<h3>Informations personnelles</h3>
<input id="nom" placeholder="Nom">
<input id="prenom" placeholder="Pr√©nom">
<input id="naissance" type="date">
<textarea id="remarque" placeholder="Remarques"></textarea>

<button class="util" onclick="save()">üíæ Sauvegarder</button>
<button class="util" onclick="exportJSON()">‚¨áÔ∏è Exporter JSON</button>
<input type="file" id="importFile" accept=".json" style="display:none" onchange="importJSON(this)">
<button class="util" onclick="document.getElementById('importFile').click()">‚¨ÜÔ∏è Importer JSON</button>
</section>

<!-- ===== VACCINS ===== -->
<section id="vaccins">
<h3>Vaccinations</h3>
<input id="vaccinNom" placeholder="Nom du vaccin">
<input id="vaccinDate" type="date">
<button class="add" onclick="addVaccin()">Ajouter</button>

<table>
<thead>
<tr>
<th onclick="setSort('nom')">Vaccin</th>
<th onclick="setSort('date')">Date</th>
<th></th>
</tr>
</thead>
<tbody id="vaccinTable"></tbody>
</table>
</section>

<!-- ===== NOTICES ===== -->
<section id="notices">
<h3>Notices</h3>
<input id="noticeNom" placeholder="Nom du vaccin">
<input id="noticeURL" placeholder="URL de la notice">
<button class="add" onclick="addNotice()">Ajouter</button>

<table>
<thead><tr><th>Vaccin</th><th>Notice</th><th></th></tr></thead>
<tbody id="noticeTable"></tbody>
</table>
</section>

<!-- ===== R√âSUM√â ===== -->
<section id="resume">
<h3>R√©sum√© vaccinal</h3>
<table>
<thead><tr><th>Vaccin</th><th>Date</th></tr></thead>
<tbody id="resumeTable"></tbody>
</table>
</section>

<script>
let data = JSON.parse(localStorage.getItem("vaccinsData")) || {
  currentPerson:0,
  persons:[
    {fiche:{},vaccins:[],notices:[]},
    {fiche:{},vaccins:[],notices:[]}
  ]
};

let sortField=null, sortAsc=true;

function current(){ return data.persons[data.currentPerson]; }

function save(){
  localStorage.setItem("vaccinsData",JSON.stringify(data));
  alert("Donn√©es sauvegard√©es");
}

/* ===== Export JSON ===== */
function exportJSON(){
  const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="vaccins.json";
  a.click();
}

/* ===== Import JSON ===== */
function importJSON(input){
  const file=input.files[0];
  if(!file) return;
  const reader=new FileReader();
  reader.onload=e=>{
    try{
      const obj=JSON.parse(e.target.result);
      if(!obj.persons || !Array.isArray(obj.persons)) throw "";
      data=obj;
      save();
      render();
      alert("Restauration r√©ussie");
    }catch{
      alert("Fichier JSON invalide");
    }
  };
  reader.readAsText(file);
}

function switchPerson(i){
  data.currentPerson=parseInt(i);
  save();
  render();
}

function showTab(id,btn){
  document.querySelectorAll("section").forEach(s=>s.classList.remove("active"));
  document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  btn.classList.add("active");
}

function addVaccin(){
  if(!vaccinNom.value||!vaccinDate.value) return;
  current().vaccins.push({nom:vaccinNom.value,date:vaccinDate.value});
  vaccinNom.value=""; vaccinDate.value="";
  save(); render();
}

function addNotice(){
  if(!noticeNom.value||!noticeURL.value) return;
  current().notices.push({nom:noticeNom.value,url:noticeURL.value});
  noticeNom.value=""; noticeURL.value="";
  save(); render();
}

function delVaccin(i){
  if(!confirm("Confirmer la suppression de ce vaccin ?")) return;
  current().vaccins.splice(i,1);
  save(); render();
}

function delNotice(i){
  if(!confirm("Confirmer la suppression de cette notice ?")) return;
  current().notices.splice(i,1);
  save(); render();
}

function setSort(f){
  sortAsc = sortField===f ? !sortAsc : true;
  sortField=f;
  render();
}

function render(){
  personSelect.value=data.currentPerson;
  vaccinTable.innerHTML="";
  noticeTable.innerHTML="";
  resumeTable.innerHTML="";

  const p=current();
  ["nom","prenom","naissance","remarque"].forEach(id=>{
    document.getElementById(id).value=p.fiche[id]||"";
  });

  let vaccins=[...p.vaccins];
  if(sortField){
    vaccins.sort((a,b)=>{
      let x=a[sortField],y=b[sortField];
      if(sortField==="date"){x=new Date(x);y=new Date(y);}
      return (x>y?1:-1)*(sortAsc?1:-1);
    });
  }

  vaccins.forEach((v,i)=>{
    vaccinTable.innerHTML+=`
    <tr>
      <td>${v.nom}</td>
      <td>${v.date}</td>
      <td><button class="del" onclick="delVaccin(${i})">‚úï</button></td>
    </tr>`;
    resumeTable.innerHTML+=`<tr><td>${v.nom}</td><td>${v.date}</td></tr>`;
  });

  p.notices.forEach((n,i)=>{
    noticeTable.innerHTML+=`
    <tr>
      <td>${n.nom}</td>
      <td><a href="${n.url}" target="_blank">${n.url}</a></td>
      <td><button class="del" onclick="delNotice(${i})">‚úï</button></td>
    </tr>`;
  });
}

["nom","prenom","naissance","remarque"].forEach(id=>{
  document.getElementById(id).addEventListener("input",e=>{
    current().fiche[id]=e.target.value;
    save();
  });
});

render();
</script>

</body>
</html>