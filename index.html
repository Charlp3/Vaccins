<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Vaccins</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    font-family:-apple-system,BlinkMacSystemFont,sans-serif;
    background:#e1e1e1;
    margin:0;
    font-size:18px;
    color:#333;
}
header{
    background:#b3b6bb;
    text-align:center;
    padding:16px;
}
header h1{
    margin:0;
    font-size:30px;
    font-weight:600;
}
#currentLabel{
    font-size:16px;
    margin-top:4px;
}
#copyright{
    font-size:14px;
    margin-top:6px;
    color:#555;
}

nav{
    display:flex;
    background:#c4c7cc;
}
nav button{
    flex:1;
    padding:16px;
    border:none;
    background:#c4c7cc;
    font-weight:600;
    font-size:18px;
    color:#444;
}
nav button.active{
    background:#aeb1b6;
}

section{
    display:none;
    padding:14px;
}
section.active{
    display:block;
}

input, textarea{
    width:100%;
    padding:12px;
    margin-bottom:12px;
    font-size:18px;
    background:#d4d6da;
    border:1px solid #b0b2b6;
    color:#333;
    border-radius:4px;
}
textarea{height:90px;}

button.util, button.add{
    background:#bfc2c6;
    border:none;
    padding:12px;
    width:100%;
    margin-bottom:10px;
    font-size:18px;
    border-radius:4px;
    font-weight:600;
}
button.del, button.edit, button.saveEdit, button.cancelEdit{
    border:none;
    border-radius:4px;
    padding:6px 10px;
    font-size:15px;
    margin:2px;
}
button.del{background:#8a8d92;color:#fff;}
button.edit{background:#9ea2a8;}
button.saveEdit{background:#7fa37f;}
button.cancelEdit{background:#b07a7a;}

table{
    width:100%;
    border-collapse:collapse;
    font-size:18px;
}
th, td{
    padding:12px;
    border:1px solid #b1b3b7;
}
th{background:#b9bcc1;}
tr:nth-child(even){background:#d8dadf;}
tr:nth-child(odd){background:#e3e5e9;}

a{color:#4a6a8a;}
</style>
</head>

<body>

<header>
    <h1>Vaccins</h1>
    <div id="currentLabel">Personne 1</div>
    <div id="copyright">¬© Pierre Charlier 2025 ‚Äî v1.9c</div>
</header>

<nav>
    <button class="active" onclick="showTab('fiche',this)">Fiche</button>
    <button onclick="showTab('vaccins',this)">Vaccinations</button>
    <button onclick="showTab('notices',this)">Notices</button>
    <button onclick="showTab('resume',this)">R√©sum√©</button>
</nav>

<!-- ================= FICHE ================= -->
<section id="fiche" class="active">

<h3>Personne</h3>
<button class="util" onclick="addPerson()">‚ûï Nouvelle personne</button>

<h3>Informations personnelles</h3>
<input id="nom" placeholder="Nom">
<input id="prenom" placeholder="Pr√©nom">
<input id="naissance" type="date">
<textarea id="remarque" placeholder="Remarques"></textarea>

<button class="util" onclick="save()">üíæ Sauvegarder</button>
<button class="util" onclick="exportJSON()">‚¨áÔ∏è Exporter JSON</button>
<input type="file" id="importFile" accept=".json" style="display:none" onchange="importJSON(this)">
<button class="util" onclick="document.getElementById('importFile').click()">‚¨ÜÔ∏è Importer JSON</button>

</section>

<!-- ================= VACCINS ================= -->
<section id="vaccins">

<h3>Vaccinations</h3>
<input id="vaccinNom" placeholder="Nom du vaccin">
<input id="vaccinDate" type="date">
<button class="add" onclick="addVaccin()">Ajouter</button>

<table>
<thead>
<tr>
    <th>Vaccin</th>
    <th>Date</th>
    <th>Actions</th>
</tr>
</thead>
<tbody id="vaccinTable"></tbody>
</table>

</section>

<!-- ================= NOTICES ================= -->
<section id="notices">

<h3>Notices</h3>
<input id="noticeNom" placeholder="Nom du vaccin">
<input id="noticeURL" placeholder="URL de la notice">
<button class="add" onclick="addNotice()">Ajouter</button>

<table>
<thead>
<tr>
    <th>Vaccin</th>
    <th>Notice</th>
    <th></th>
</tr>
</thead>
<tbody id="noticeTable"></tbody>
</table>

</section>

<!-- ================= R√âSUM√â ================= -->
<section id="resume">

<h3>R√©sum√© vaccinal</h3>
<table>
<thead>
<tr>
    <th>Vaccin</th>
    <th>Date</th>
</tr>
</thead>
<tbody id="resumeTable"></tbody>
</table>

</section>

<script>
/* ===== Donn√©es ===== */
let data = JSON.parse(localStorage.getItem("vaccinsData")) || {
    currentPerson: 0,
    persons: []
};

/* ===== Initialisation s√ªre ===== */
if(data.persons.length === 0){
    data.persons.push({
        label: "Personne 1",
        fiche: {},
        vaccins: [],
        notices: []
    });
}

/* ===== Acc√®s courant ===== */
function current(){
    return data.persons[data.currentPerson];
}

/* ===== Sauvegarde ===== */
function save(){
    localStorage.setItem("vaccinsData", JSON.stringify(data));
}

/* ===== Export / Import JSON ===== */
function exportJSON(){
    const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "vaccins.json";
    a.click();
}

function importJSON(input){
    const file = input.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = e => {
        try{
            const obj = JSON.parse(e.target.result);
            if(!obj.persons) throw "";
            data = obj;
            save();
            render();
            alert("Restauration r√©ussie");
        }catch{
            alert("Fichier JSON invalide");
        }
    };
    reader.readAsText(file);
}

/* ===== Personnes ===== */
function addPerson(){
    const label = prompt("Nom de la nouvelle personne :");
    if(!label) return;

    data.persons.push({
        label: label,
        fiche: {},
        vaccins: [],
        notices: []
    });

    data.currentPerson = data.persons.length - 1;
    save();
    render();
}

/* ===== Navigation ===== */
function showTab(id, btn){
    document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
    document.querySelectorAll("nav button").forEach(b => b.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    btn.classList.add("active");
}

/* ===== Vaccins ===== */
function addVaccin(){
    if(!vaccinNom.value || !vaccinDate.value) return;
    current().vaccins.push({nom: vaccinNom.value, date: vaccinDate.value});
    vaccinNom.value = "";
    vaccinDate.value = "";
    save();
    render();
}

function delVaccin(i){
    if(!confirm("Supprimer ce vaccin ?")) return;
    current().vaccins.splice(i, 1);
    save();
    render();
}

function editVaccin(i){
    const v = current().vaccins[i];
    vaccinTable.children[i].innerHTML = `
        <td><input value="${v.nom}"></td>
        <td><input type="date" value="${v.date}"></td>
        <td>
            <button class="saveEdit" onclick="saveVaccinEdit(${i},this)">üíæ</button>
            <button class="cancelEdit" onclick="render()">‚úñ</button>
        </td>`;
}

function saveVaccinEdit(i, btn){
    const row = btn.closest("tr");
    const inputs = row.querySelectorAll("input");
    current().vaccins[i] = {nom: inputs[0].value, date: inputs[1].value};
    save();
    render();
}

/* ===== Notices ===== */
function addNotice(){
    if(!noticeNom.value || !noticeURL.value) return;
    current().notices.push({nom: noticeNom.value, url: noticeURL.value});
    noticeNom.value = "";
    noticeURL.value = "";
    save();
    render();
}

function delNotice(i){
    if(!confirm("Supprimer cette notice ?")) return;
    current().notices.splice(i, 1);
    save();
    render();
}

/* ===== Affichage ===== */
function render(){
    const p = current();
    currentLabel.textContent = p.label;

    ["nom","prenom","naissance","remarque"].forEach(id=>{
        document.getElementById(id).value = p.fiche[id] || "";
    });

    vaccinTable.innerHTML = "";
    resumeTable.innerHTML = "";
    p.vaccins.forEach((v,i)=>{
        vaccinTable.innerHTML += `
        <tr>
            <td>${v.nom}</td>
            <td>${v.date}</td>
            <td>
                <button class="edit" onclick="editVaccin(${i})">‚úèÔ∏è</button>
                <button class="del" onclick="delVaccin(${i})">üóëÔ∏è</button>
            </td>
        </tr>`;
        resumeTable.innerHTML += `<tr><td>${v.nom}</td><td>${v.date}</td></tr>`;
    });

    noticeTable.innerHTML = "";
    p.notices.forEach((n,i)=>{
        noticeTable.innerHTML += `
        <tr>
            <td>${n.nom}</td>
            <td><a href="${n.url}" target="_blank">${n.url}</a></td>
            <td><button class="del" onclick="delNotice(${i})">üóëÔ∏è</button></td>
        </tr>`;
    });
}

/* ===== √âcouteurs fiche ===== */
["nom","prenom","naissance","remarque"].forEach(id=>{
    document.getElementById(id).addEventListener("input", e=>{
        current().fiche[id] = e.target.value;
        save();
    });
});

render();
</script>

</body>
</html>